import {flattenSVG} from 'flatten-svg';
//import _ from 'lodash';

var silkscreenHeader = 
`G04 Silkscreen top layer*
%FSAX35Y35*%
G71*
G01*
G75*
%MOMM*%
%ADD10C,1.5*%
G04 start drawing*
D10*
`

var gerberEOF = `M02*`

var convButton = document.getElementById('convert-button');

var svgInputStr = document.getElementById('svg_input').value;


document.addEventListener("keyup", function(event) {
    if (event.keyCode === 13) {
       console.log(document.getElementById('svg_input').value)


       var mySvg = svgElementFromString(document.getElementById('svg_input').value);


       let mypaths = flattenSVG(mySvg);
        console.log('flattenSVGPoints')
        console.log(paths); 


        var gerberFromPoints = generateSilkscreenFromPoints(mypaths)
        console.log(gerberFromPoints);

        download('silkscreen_top.GTO', gerberFromPoints);
    }


});

;
console.log('button')
console.log(convButton)

var svg = document.getElementById('test-svg')

//body.innerHTML += `<button id='convert-button' onclick='convert()' size>convert</button>`
 console.log('document')
console.log(document);

var svgElementFromString = function(str) {
    var div = document.createElement('DIV');
    div.innerHTML = str;
    var svg = div.querySelector('svg');
    if (!svg) { console.log('No SVG found in loaded contents'); return; }
    else return svg;
  }


/*   var mySvg = svgElementFromString(
   `<svg width="988.2" height="75.201" viewBox="0 0 988.2 75.201" xmlns="http://www.w3.org/2000/svg"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#000" stroke-width="0.25mm" fill="none" style="stroke:#000;stroke-width:0.25mm;fill:none"><path d="M 439.6 22 L 439.6 30.7 Q 442.4 26.5 446.65 23.65 A 16.871 16.871 0 0 1 454.952 20.856 A 20.954 20.954 0 0 1 456.5 20.8 Q 462.034 20.8 465.736 23.15 A 12.847 12.847 0 0 1 466.6 23.75 A 15.79 15.79 0 0 1 471.615 30.259 A 19.746 19.746 0 0 1 472.2 31.8 Q 475.3 27.2 479.55 24 A 15.669 15.669 0 0 1 486.341 21.116 A 21.446 21.446 0 0 1 490.1 20.8 A 21.325 21.325 0 0 1 493.749 21.097 A 15.685 15.685 0 0 1 497.45 22.2 Q 500.6 23.6 502.7 26.15 A 16.329 16.329 0 0 1 505.239 30.486 A 19.878 19.878 0 0 1 505.85 32.25 A 25.375 25.375 0 0 1 506.752 36.98 A 31.994 31.994 0 0 1 506.9 40.1 L 506.9 74 L 497.9 74 L 497.9 40.8 A 19.042 19.042 0 0 0 497.563 37.111 Q 497.127 34.905 496.128 33.161 A 10.982 10.982 0 0 0 495.4 32.05 A 7.974 7.974 0 0 0 489.587 28.754 A 10.678 10.678 0 0 0 488.5 28.7 Q 486.2 28.7 484.1 29.6 A 16.543 16.543 0 0 0 480.578 31.673 A 18.722 18.722 0 0 0 480.1 32.05 A 25.622 25.622 0 0 0 477.145 34.899 A 29.189 29.189 0 0 0 476.5 35.65 Q 474.8 37.7 473.4 39.9 L 473.4 74 L 464.4 74 L 464.4 40.8 A 19.042 19.042 0 0 0 464.063 37.111 Q 463.627 34.905 462.628 33.161 A 10.982 10.982 0 0 0 461.9 32.05 A 7.974 7.974 0 0 0 456.087 28.754 A 10.678 10.678 0 0 0 455 28.7 Q 452.8 28.7 450.7 29.55 A 16.859 16.859 0 0 0 447.387 31.36 A 19.345 19.345 0 0 0 446.65 31.9 Q 444.7 33.4 443 35.4 Q 441.3 37.4 439.9 39.6 L 439.9 74 L 430.9 74 L 430.9 22 L 439.6 22 Z M 70.5 0 L 70.5 30.3 Q 73.3 26.2 77.55 23.5 A 17.126 17.126 0 0 1 84.09 21.077 A 22.699 22.699 0 0 1 87.7 20.8 A 23.225 23.225 0 0 1 92.765 21.318 Q 97.859 22.456 100.85 26.1 Q 104.975 31.126 105.188 39.209 A 33.764 33.764 0 0 1 105.2 40.1 L 105.2 74 L 96.2 74 L 96.2 41.1 Q 96.2 36.803 94.751 33.841 A 10.747 10.747 0 0 0 93.65 32.05 Q 91.1 28.7 86.3 28.7 Q 84 28.7 81.75 29.55 Q 79.5 30.4 77.5 31.9 A 26.152 26.152 0 0 0 74.21 34.847 A 29.423 29.423 0 0 0 73.7 35.4 Q 71.9 37.4 70.5 39.6 L 70.5 74 L 61.5 74 L 61.5 0 L 70.5 0 Z M 900.5 69.1 L 919 47.6 L 901.2 27 L 908.2 20.9 L 924.3 41.7 L 940.1 21.3 L 946.8 27 L 929.5 47.2 L 948.5 69.1 L 941.7 74.9 L 924.2 53.2 L 906.9 74.7 L 900.5 69.1 Z M 141.2 69.8 L 145 62.3 A 17.402 17.402 0 0 0 148.352 64.603 A 23.322 23.322 0 0 0 151.55 66 A 24.791 24.791 0 0 0 159.022 67.383 A 28.367 28.367 0 0 0 160 67.4 Q 165.392 67.4 168.235 65.685 A 7.738 7.738 0 0 0 168.45 65.55 Q 171.3 63.7 171.3 60.8 A 7.211 7.211 0 0 0 170.916 58.432 A 6.796 6.796 0 0 0 170.75 58 A 5.377 5.377 0 0 0 170.037 56.803 Q 169.649 56.304 169.119 55.821 A 10.185 10.185 0 0 0 168.75 55.5 A 12.59 12.59 0 0 0 167.515 54.607 Q 166.831 54.169 166.002 53.737 A 27.422 27.422 0 0 0 164.8 53.15 Q 163.12 52.377 160.764 51.492 A 115.589 115.589 0 0 0 158.3 50.6 A 47.106 47.106 0 0 1 154.046 48.945 Q 149.775 47.022 147.3 44.65 A 11.347 11.347 0 0 1 144.069 38.736 A 16.941 16.941 0 0 1 143.7 35.1 Q 143.7 32.1 145.05 29.5 A 13.242 13.242 0 0 1 148.036 25.704 A 15.791 15.791 0 0 1 148.95 24.95 A 17.33 17.33 0 0 1 152.366 22.934 A 22.664 22.664 0 0 1 155.15 21.9 A 24.963 24.963 0 0 1 159.292 21.046 A 34.316 34.316 0 0 1 163.5 20.8 Q 168.152 20.8 171.764 21.674 A 24.48 24.48 0 0 1 172.45 21.85 A 38.541 38.541 0 0 1 176.757 23.291 A 31.513 31.513 0 0 1 179.4 24.5 L 176.9 31.9 Q 174.2 30.3 170.75 29.3 A 25.024 25.024 0 0 0 166.267 28.453 A 31.837 31.837 0 0 0 163.1 28.3 A 20.632 20.632 0 0 0 160.163 28.495 Q 157.077 28.94 155.2 30.4 A 9.322 9.322 0 0 0 153.842 31.673 Q 153.14 32.492 152.805 33.365 A 4.529 4.529 0 0 0 152.5 35 A 5.568 5.568 0 0 0 152.694 36.488 A 4.93 4.93 0 0 0 152.95 37.2 Q 153.324 38.032 154.217 38.794 A 7.753 7.753 0 0 0 154.6 39.1 Q 155.8 40 157.8 40.9 A 38.11 38.11 0 0 0 159.441 41.589 Q 160.925 42.175 162.8 42.8 Q 166.552 44.102 169.424 45.432 A 45.049 45.049 0 0 1 171.1 46.25 A 27.212 27.212 0 0 1 173.815 47.841 Q 175.115 48.713 176.141 49.659 A 15.68 15.68 0 0 1 176.6 50.1 A 13.836 13.836 0 0 1 178.538 52.502 A 11.394 11.394 0 0 1 179.6 54.65 A 14.613 14.613 0 0 1 180.394 58.102 A 18.255 18.255 0 0 1 180.5 60.1 A 14.031 14.031 0 0 1 179.971 64.009 A 12.235 12.235 0 0 1 179 66.4 Q 177.5 69.2 174.8 71.15 A 17.953 17.953 0 0 1 171.294 73.104 A 23.774 23.774 0 0 1 168.25 74.15 Q 164.4 75.2 159.7 75.2 A 41.103 41.103 0 0 1 154.193 74.848 A 30.514 30.514 0 0 1 149 73.7 A 30.72 30.72 0 0 1 145.194 72.215 Q 143.225 71.283 141.644 70.133 A 18.536 18.536 0 0 1 141.2 69.8 Z M 243 69.8 L 246.8 62.3 A 17.402 17.402 0 0 0 250.152 64.603 A 23.322 23.322 0 0 0 253.35 66 A 24.791 24.791 0 0 0 260.822 67.383 A 28.367 28.367 0 0 0 261.8 67.4 Q 267.192 67.4 270.035 65.685 A 7.738 7.738 0 0 0 270.25 65.55 Q 273.1 63.7 273.1 60.8 A 7.211 7.211 0 0 0 272.716 58.432 A 6.796 6.796 0 0 0 272.55 58 A 5.377 5.377 0 0 0 271.837 56.803 Q 271.449 56.304 270.919 55.821 A 10.185 10.185 0 0 0 270.55 55.5 A 12.59 12.59 0 0 0 269.315 54.607 Q 268.631 54.169 267.802 53.737 A 27.422 27.422 0 0 0 266.6 53.15 Q 264.92 52.377 262.564 51.492 A 115.589 115.589 0 0 0 260.1 50.6 A 47.106 47.106 0 0 1 255.846 48.945 Q 251.575 47.022 249.1 44.65 A 11.347 11.347 0 0 1 245.869 38.736 A 16.941 16.941 0 0 1 245.5 35.1 Q 245.5 32.1 246.85 29.5 A 13.242 13.242 0 0 1 249.836 25.704 A 15.791 15.791 0 0 1 250.75 24.95 A 17.33 17.33 0 0 1 254.166 22.934 A 22.664 22.664 0 0 1 256.95 21.9 A 24.963 24.963 0 0 1 261.092 21.046 A 34.316 34.316 0 0 1 265.3 20.8 Q 269.952 20.8 273.564 21.674 A 24.48 24.48 0 0 1 274.25 21.85 A 38.541 38.541 0 0 1 278.557 23.291 A 31.513 31.513 0 0 1 281.2 24.5 L 278.7 31.9 Q 276 30.3 272.55 29.3 A 25.024 25.024 0 0 0 268.067 28.453 A 31.837 31.837 0 0 0 264.9 28.3 A 20.632 20.632 0 0 0 261.963 28.495 Q 258.877 28.94 257 30.4 A 9.322 9.322 0 0 0 255.642 31.673 Q 254.94 32.492 254.605 33.365 A 4.529 4.529 0 0 0 254.3 35 A 5.568 5.568 0 0 0 254.494 36.488 A 4.93 4.93 0 0 0 254.75 37.2 Q 255.124 38.032 256.017 38.794 A 7.753 7.753 0 0 0 256.4 39.1 Q 257.6 40 259.6 40.9 A 38.11 38.11 0 0 0 261.241 41.589 Q 262.725 42.175 264.6 42.8 Q 268.352 44.102 271.224 45.432 A 45.049 45.049 0 0 1 272.9 46.25 A 27.212 27.212 0 0 1 275.615 47.841 Q 276.915 48.713 277.941 49.659 A 15.68 15.68 0 0 1 278.4 50.1 A 13.836 13.836 0 0 1 280.338 52.502 A 11.394 11.394 0 0 1 281.4 54.65 A 14.613 14.613 0 0 1 282.194 58.102 A 18.255 18.255 0 0 1 282.3 60.1 A 14.031 14.031 0 0 1 281.771 64.009 A 12.235 12.235 0 0 1 280.8 66.4 Q 279.3 69.2 276.6 71.15 A 17.953 17.953 0 0 1 273.094 73.104 A 23.774 23.774 0 0 1 270.05 74.15 Q 266.2 75.2 261.5 75.2 A 41.103 41.103 0 0 1 255.993 74.848 A 30.514 30.514 0 0 1 250.8 73.7 A 30.72 30.72 0 0 1 246.994 72.215 Q 245.025 71.283 243.444 70.133 A 18.536 18.536 0 0 1 243 69.8 Z M 319.8 69.8 L 323.6 62.3 A 17.402 17.402 0 0 0 326.952 64.603 A 23.322 23.322 0 0 0 330.15 66 A 24.791 24.791 0 0 0 337.622 67.383 A 28.367 28.367 0 0 0 338.6 67.4 Q 343.992 67.4 346.835 65.685 A 7.738 7.738 0 0 0 347.05 65.55 Q 349.9 63.7 349.9 60.8 A 7.211 7.211 0 0 0 349.516 58.432 A 6.796 6.796 0 0 0 349.35 58 A 5.377 5.377 0 0 0 348.637 56.803 Q 348.249 56.304 347.719 55.821 A 10.185 10.185 0 0 0 347.35 55.5 A 12.59 12.59 0 0 0 346.115 54.607 Q 345.431 54.169 344.602 53.737 A 27.422 27.422 0 0 0 343.4 53.15 Q 341.72 52.377 339.364 51.492 A 115.589 115.589 0 0 0 336.9 50.6 A 47.106 47.106 0 0 1 332.646 48.945 Q 328.375 47.022 325.9 44.65 A 11.347 11.347 0 0 1 322.669 38.736 A 16.941 16.941 0 0 1 322.3 35.1 Q 322.3 32.1 323.65 29.5 A 13.242 13.242 0 0 1 326.636 25.704 A 15.791 15.791 0 0 1 327.55 24.95 A 17.33 17.33 0 0 1 330.966 22.934 A 22.664 22.664 0 0 1 333.75 21.9 A 24.963 24.963 0 0 1 337.892 21.046 A 34.316 34.316 0 0 1 342.1 20.8 Q 346.752 20.8 350.364 21.674 A 24.48 24.48 0 0 1 351.05 21.85 A 38.541 38.541 0 0 1 355.357 23.291 A 31.513 31.513 0 0 1 358 24.5 L 355.5 31.9 Q 352.8 30.3 349.35 29.3 A 25.024 25.024 0 0 0 344.867 28.453 A 31.837 31.837 0 0 0 341.7 28.3 A 20.632 20.632 0 0 0 338.763 28.495 Q 335.677 28.94 333.8 30.4 A 9.322 9.322 0 0 0 332.442 31.673 Q 331.74 32.492 331.405 33.365 A 4.529 4.529 0 0 0 331.1 35 A 5.568 5.568 0 0 0 331.294 36.488 A 4.93 4.93 0 0 0 331.55 37.2 Q 331.924 38.032 332.817 38.794 A 7.753 7.753 0 0 0 333.2 39.1 Q 334.4 40 336.4 40.9 A 38.11 38.11 0 0 0 338.041 41.589 Q 339.525 42.175 341.4 42.8 Q 345.152 44.102 348.024 45.432 A 45.049 45.049 0 0 1 349.7 46.25 A 27.212 27.212 0 0 1 352.415 47.841 Q 353.715 48.713 354.741 49.659 A 15.68 15.68 0 0 1 355.2 50.1 A 13.836 13.836 0 0 1 357.138 52.502 A 11.394 11.394 0 0 1 358.2 54.65 A 14.613 14.613 0 0 1 358.994 58.102 A 18.255 18.255 0 0 1 359.1 60.1 A 14.031 14.031 0 0 1 358.571 64.009 A 12.235 12.235 0 0 1 357.6 66.4 Q 356.1 69.2 353.4 71.15 A 17.953 17.953 0 0 1 349.894 73.104 A 23.774 23.774 0 0 1 346.85 74.15 Q 343 75.2 338.3 75.2 A 41.103 41.103 0 0 1 332.793 74.848 A 30.514 30.514 0 0 1 327.6 73.7 A 30.72 30.72 0 0 1 323.794 72.215 Q 321.825 71.283 320.244 70.133 A 18.536 18.536 0 0 1 319.8 69.8 Z M 694.4 69.8 L 698.2 62.3 A 17.402 17.402 0 0 0 701.552 64.603 A 23.322 23.322 0 0 0 704.75 66 A 24.791 24.791 0 0 0 712.222 67.383 A 28.367 28.367 0 0 0 713.2 67.4 Q 718.592 67.4 721.435 65.685 A 7.738 7.738 0 0 0 721.65 65.55 Q 724.5 63.7 724.5 60.8 A 7.211 7.211 0 0 0 724.116 58.432 A 6.796 6.796 0 0 0 723.95 58 A 5.377 5.377 0 0 0 723.237 56.803 Q 722.849 56.304 722.319 55.821 A 10.185 10.185 0 0 0 721.95 55.5 A 12.59 12.59 0 0 0 720.715 54.607 Q 720.031 54.169 719.202 53.737 A 27.422 27.422 0 0 0 718 53.15 Q 716.32 52.377 713.964 51.492 A 115.589 115.589 0 0 0 711.5 50.6 A 47.106 47.106 0 0 1 707.246 48.945 Q 702.975 47.022 700.5 44.65 A 11.347 11.347 0 0 1 697.269 38.736 A 16.941 16.941 0 0 1 696.9 35.1 Q 696.9 32.1 698.25 29.5 A 13.242 13.242 0 0 1 701.236 25.704 A 15.791 15.791 0 0 1 702.15 24.95 A 17.33 17.33 0 0 1 705.566 22.934 A 22.664 22.664 0 0 1 708.35 21.9 A 24.963 24.963 0 0 1 712.492 21.046 
A 34.316 34.316 0 0 1 716.7 20.8 Q 721.352 20.8 724.964 21.674 A 24.48 24.48 0 0 1 725.65 21.85 A 38.541 38.541 0 0 1 729.957 23.291 A 31.513 31.513 0 0 1 732.6 24.5 L 730.1 31.9 Q 727.4 30.3 723.95 29.3 A 25.024 25.024 0 0 0 719.467 28.453 A 31.837 31.837 0 0 0 716.3 28.3 A 20.632 20.632 0 0 0 713.363 28.495 Q 710.277 28.94 708.4 30.4 A 9.322 9.322 0 0 0 707.042 31.673 Q 706.34 32.492 706.005 33.365 A 4.529 4.529 0 0 0 705.7 35 A 5.568 5.568 0 0 0 705.894 36.488 A 4.93 4.93 0 0 0 706.15 37.2 Q 706.524 38.032 707.417 38.794 A 7.753 7.753 0 0 0 707.8 39.1 Q 709 40 711 40.9 A 38.11 38.11 0 0 0 712.641 41.589 Q 714.125 42.175 716 42.8 Q 719.752 44.102 722.624 45.432 A 45.049 45.049 0 0 1 724.3 46.25 A 27.212 27.212 0 0 1 727.015 47.841 Q 728.315 48.713 729.341 49.659 A 15.68 15.68 0 0 1 729.8 50.1 A 13.836 13.836 0 0 1 731.738 52.502 A 11.394 11.394 0 0 1 732.8 54.65 A 14.613 14.613 0 0 1 733.594 58.102 A 18.255 18.255 0 0 1 733.7 60.1 A 14.031 14.031 0 0 1 733.171 64.009 A 12.235 12.235 0 0 1 732.2 66.4 Q 730.7 69.2 728 71.15 A 17.953 17.953 0 0 1 724.494 73.104 A 23.774 23.774 0 0 1 721.45 74.15 Q 717.6 75.2 712.9 75.2 A 41.103 41.103 0 0 1 707.393 74.848 A 30.514 30.514 0 0 1 702.2 73.7 A 30.72 30.72 0 0 1 698.394 72.215 Q 696.425 71.283 694.844 70.133 A 18.536 18.536 0 0 1 694.4 69.8 Z M 0 12.4 L 0 4 L 52.5 4 L 52.5 12.4 L 31 12.4 L 31 74 L 21.5 74 L 21.5 12.4 L 0 12.4 Z M 564.5 51.7 L 528.1 51.7 A 24.088 24.088 0 0 0 529.239 56.725 Q 530.575 60.538 533.2 63.1 Q 537.4 67.2 544.3 67.2 Q 548.8 67.2 552.4 66.25 Q 556 65.3 559.3 63.8 L 561.4 71.5 A 35.406 35.406 0 0 1 556.581 73.342 A 44.267 44.267 0 0 1 553.3 74.2 A 40.711 40.711 0 0 1 548.208 74.98 A 54.607 54.607 0 0 1 543.2 75.2 A 29.178 29.178 0 0 1 537.404 74.647 A 23.608 23.608 0 0 1 533.1 73.35 Q 528.6 71.5 525.45 68.05 A 22.127 22.127 0 0 1 521.804 62.55 A 27.574 27.574 0 0 1 520.6 59.55 A 31.581 31.581 0 0 1 519.249 53.593 A 42.813 42.813 0 0 1 518.9 48 A 34.878 34.878 0 0 1 519.704 40.403 A 30.597 30.597 0 0 1 520.6 37.2 A 27.699 27.699 0 0 1 523.414 31.251 A 24.152 24.152 0 0 1 525.4 28.55 Q 528.5 24.9 532.8 22.85 Q 537.1 20.8 542.4 20.8 A 27.908 27.908 0 0 1 547.304 21.211 A 20.619 20.619 0 0 1 552.2 22.7 Q 556.4 24.6 559.2 27.9 Q 562 31.2 563.4 35.6 A 30.348 30.348 0 0 1 564.797 44.442 A 34.055 34.055 0 0 1 564.8 44.9 A 75.204 75.204 0 0 1 564.509 51.597 A 69.426 69.426 0 0 1 564.5 51.7 Z M 686.6 51.7 L 650.2 51.7 A 24.088 24.088 0 0 0 651.339 56.725 Q 652.675 60.538 655.3 63.1 Q 659.5 67.2 666.4 67.2 Q 670.9 67.2 674.5 66.25 Q 678.1 65.3 681.4 63.8 L 683.5 71.5 A 35.406 35.406 0 0 1 678.681 73.342 A 44.267 44.267 0 0 1 675.4 74.2 A 40.711 40.711 0 0 1 670.308 74.98 A 54.607 54.607 0 0 1 665.3 75.2 A 29.178 29.178 0 0 1 659.504 74.647 A 23.608 23.608 0 0 1 655.2 73.35 Q 650.7 71.5 647.55 68.05 A 22.127 22.127 0 0 1 643.904 62.55 A 27.574 27.574 0 0 1 642.7 59.55 A 31.581 31.581 0 0 1 641.349 53.593 A 42.813 42.813 0 0 1 641 48 A 34.878 34.878 0 0 1 641.804 40.403 A 30.597 30.597 0 0 1 642.7 37.2 A 27.699 27.699 0 0 1 645.514 31.251 A 24.152 24.152 0 0 1 647.5 28.55 Q 650.6 24.9 654.9 22.85 Q 659.2 20.8 664.5 20.8 A 27.908 27.908 0 0 1 669.404 21.211 A 20.619 20.619 0 0 1 674.3 22.7 Q 678.5 24.6 681.3 27.9 Q 684.1 31.2 685.5 35.6 A 30.348 30.348 0 0 1 686.897 44.442 A 34.055 34.055 0 0 1 686.9 44.9 A 75.204 75.204 0 0 1 686.609 51.597 A 69.426 69.426 0 0 1 686.6 51.7 Z M 895.2 51.7 L 858.8 51.7 A 24.088 24.088 0 0 0 859.939 56.725 Q 861.275 60.538 863.9 63.1 Q 868.1 67.2 875 67.2 Q 879.5 67.2 883.1 66.25 Q 886.7 65.3 890 63.8 L 892.1 71.5 A 35.406 35.406 0 0 1 887.281 73.342 A 44.267 44.267 0 0 1 884 74.2 A 40.711 40.711 0 0 1 878.908 74.98 A 54.607 54.607 0 0 1 873.9 75.2 A 29.178 29.178 0 0 1 868.104 74.647 A 23.608 23.608 0 0 1 863.8 73.35 Q 859.3 71.5 856.15 68.05 A 22.127 22.127 0 0 1 852.504 62.55 A 27.574 27.574 0 0 1 851.3 59.55 A 31.581 31.581 0 0 1 849.949 53.593 A 42.813 42.813 0 0 1 849.6 48 A 34.878 34.878 0 0 1 850.404 40.403 A 30.597 30.597 0 0 1 851.3 37.2 A 27.699 27.699 0 0 1 854.114 31.251 A 24.152 24.152 0 0 1 856.1 28.55 Q 859.2 24.9 863.5 22.85 Q 867.8 20.8 873.1 20.8 A 27.908 27.908 0 0 1 878.004 21.211 A 20.619 20.619 0 0 1 882.9 22.7 Q 887.1 24.6 889.9 27.9 Q 892.7 31.2 894.1 35.6 A 30.348 30.348 0 0 1 895.497 44.442 A 34.055 34.055 0 0 1 895.5 44.9 A 75.204 75.204 0 0 1 895.209 51.597 A 69.426 69.426 0 0 1 895.2 51.7 Z M 609 23.9 L 610.9 7.5 L 617.8 7.5 L 617.8 23.9 L 632.2 23.9 L 632.2 31.7 L 617.8 31.7 L 617.8 56.8 A 21.675 21.675 0 0 0 617.891 58.848 Q 617.987 59.849 618.181 60.713 A 11.029 11.029 0 0 0 618.45 61.7 Q 619.1 63.7 620.2 64.9 Q 621.3 66.1 622.85 66.65 Q 624.4 67.2 626.1 67.2 A 13.893 13.893 0 0 0 629.964 66.672 A 12.868 12.868 0 0 0 630.8 66.4 Q 633 65.6 635 64.5 L 637.5 71.7 A 18.546 18.546 0 0 1 635.882 72.556 Q 635.08 72.935 634.134 73.308 A 43.365 43.365 0 0 1 632.1 74.05 Q 628.7 75.2 625 75.2 A 18.502 18.502 0 0 1 619.818 74.511 A 13.951 13.951 0 0 1 613.15 70.3 A 15.787 15.787 0 0 1 609.974 64.576 Q 609.204 62.184 608.939 59.281 A 35.038 35.038 0 0 1 608.8 56.1 L 608.8 31.7 L 599.8 31.7 L 599.8 23.9 L 609 23.9 Z M 747.9 23.9 L 749.8 7.5 L 756.7 7.5 L 756.7 23.9 L 771.1 23.9 L 771.1 31.7 L 756.7 31.7 L 756.7 56.8 A 21.675 21.675 0 0 0 756.791 58.848 Q 756.887 59.849 757.081 60.713 A 11.029 11.029 0 0 0 757.35 61.7 Q 758 63.7 759.1 64.9 Q 760.2 66.1 761.75 66.65 Q 763.3 67.2 765 67.2 A 13.893 13.893 0 0 0 768.864 66.672 A 12.868 12.868 0 0 0 769.7 66.4 Q 771.9 65.6 773.9 64.5 L 776.4 71.7 A 18.546 18.546 0 0 1 774.782 72.556 Q 773.98 72.935 773.034 73.308 A 43.365 43.365 0 0 1 771 74.05 Q 767.6 75.2 763.9 75.2 A 18.502 18.502 0 0 1 758.718 74.511 A 13.951 13.951 0 0 1 752.05 70.3 A 15.787 15.787 0 0 1 748.874 64.576 Q 748.104 62.184 747.839 59.281 A 35.038 35.038 0 0 1 747.7 56.1 L 747.7 31.7 L 738.7 31.7 L 738.7 23.9 L 747.9 23.9 Z M 817.6 23.9 L 819.5 7.5 L 826.4 7.5 L 826.4 23.9 L 840.8 23.9 L 840.8 31.7 L 826.4 31.7 L 826.4 56.8 A 21.675 21.675 0 0 0 826.491 58.848 Q 826.587 59.849 826.781 60.713 A 11.029 11.029 0 0 0 827.05 61.7 Q 827.7 63.7 828.8 64.9 Q 829.9 66.1 831.45 66.65 Q 833 67.2 834.7 67.2 A 13.893 13.893 0 0 0 838.564 66.672 A 12.868 12.868 0 0 0 839.4 66.4 Q 841.6 65.6 843.6 64.5 L 846.1 71.7 A 18.546 18.546 0 0 1 844.482 72.556 Q 843.68 72.935 842.734 73.308 A 43.365 43.365 0 0 1 840.7 74.05 Q 837.3 75.2 833.6 75.2 A 18.502 18.502 0 0 1 828.418 74.511 A 13.951 13.951 0 0 1 821.75 70.3 A 15.787 15.787 0 0 1 818.574 64.576 Q 817.804 62.184 817.539 59.281 A 35.038 35.038 0 0 1 817.4 56.1 L 817.4 31.7 L 808.4 31.7 L 808.4 23.9 L 817.6 23.9 Z M 959.7 23.9 L 961.6 7.5 L 968.5 7.5 L 968.5 23.9 L 982.9 23.9 L 982.9 31.7 L 968.5 31.7 L 968.5 56.8 A 21.675 21.675 0 0 0 968.591 58.848 Q 968.687 59.849 968.881 60.713 A 11.029 11.029 0 0 0 969.15 61.7 Q 969.8 63.7 970.9 64.9 Q 972 66.1 973.55 66.65 Q 975.1 67.2 976.8 67.2 A 13.893 13.893 0 0 0 980.664 66.672 A 12.868 12.868 0 0 0 981.5 66.4 Q 983.7 65.6 985.7 64.5 L 988.2 71.7 A 18.546 18.546 0 0 1 986.582 72.556 Q 985.78 72.935 984.834 73.308 A 43.365 43.365 0 0 1 982.8 74.05 Q 979.4 75.2 975.7 75.2 A 18.502 18.502 0 0 1 970.518 74.511 A 13.951 13.951 0 0 1 963.85 70.3 A 15.787 15.787 0 0 1 960.674 64.576 Q 959.904 62.184 959.639 59.281 A 35.038 35.038 0 0 1 959.5 56.1 L 959.5 31.7 L 950.5 31.7 L 950.5 23.9 L 959.7 23.9 Z M 367.664 41.659 A 34.196 34.196 0 0 0 367.1 48 A 34.702 34.702 0 0 0 367.23 51.027 A 28.722 28.722 0 0 0 369.05 59 A 29.451 29.451 0 0 0 369.561 60.228 A 25.437 25.437 0 0 0 374.45 67.6 Q 377.9 71.2 382.65 73.2 A 24.648 24.648 0 0 0 385.702 74.255 A 27.492 27.492 0 0 0 393 75.2 A 30.449 30.449 0 0 0 394.025 75.183 A 26.432 26.432 0 0 0 403.25 73.25 Q 408 71.3 411.5 67.7 A 23.825 23.825 0 0 0 413.346 65.56 A 26.161 26.161 0 0 0 416.95 59.05 A 27.814 27.814 0 0 0 418.283 54.411 A 34.074 34.074 0 0 0 418.9 47.8 A 34.924 34.924 0 0 0 418.664 43.679 A 27.811 27.811 0 0 0 416.9 36.6 A 28.718 28.718 0 0 0 416.238 35.074 A 24.42 24.42 0 0 0 411.4 28.1 Q 407.9 24.6 403.15 22.7 A 26.059 26.059 0 0 0 402.554 22.47 A 27.19 27.19 0 0 0 393 20.8 A 31.154 31.154 0 0 0 391.806 20.823 A 26.981 26.981 0 0 0 382.75 22.7 Q 378 24.6 374.55 28.1 Q 371.1 31.6 369.1 36.65 A 27.311 27.311 0 0 0 367.664 41.659 Z M 129.7 22 L 129.7 74 L 120.7 74 L 120.7 22 L 129.7 22 Z M 231.5 22 L 231.5 74 L 222.5 74 L 222.5 22 L 231.5 22 Z M 409.7 48 Q 409.7 44.1 408.45 40.6 A 19.563 19.563 0 0 0 406.075 35.945 A 17.715 17.715 0 0 0 404.95 34.5 Q 402.7 31.9 399.65 30.35 Q 396.6 28.8 393 28.8 A 19.249 19.249 0 0 0 387.774 29.472 A 14.037 14.037 0 0 0 380.7 34 A 17.878 17.878 0 0 0 377.026 41.374 Q 376.3 44.306 376.3 47.8 Q 376.3 51.7 377.55 55.25 A 20.131 20.131 0 0 0 379.863 59.888 A 18.151 18.151 0 0 0 381.05 61.45 Q 383.3 64.1 386.35 65.65 Q 389.4 67.2 393 67.2 A 18.689 18.689 0 0 0 396.918 66.805 A 15.186 15.186 0 0 0 400 65.8 Q 403.1 64.4 405.25 61.85 A 17.366 17.366 0 0 0 407.999 57.286 A 20.701 20.701 0 0 0 408.55 55.8 A 22.798 22.798 0 0 0 409.535 51.144 A 29.007 29.007 0 0 0 409.7 48 Z M 528 44.4 L 556.5 44.4 A 24.355 24.355 0 0 0 556.096 39.815 Q 555.6 37.231 554.496 35.207 A 12.422 12.422 0 0 0 552.7 32.7 A 12.488 12.488 0 0 0 545.739 28.924 A 18.395 18.395 0 0 0 542.2 28.6 Q 536.3 28.6 532.55 32.6 A 14.739 14.739 0 0 0 529.757 37.005 Q 528.932 38.961 528.452 41.361 A 32.287 32.287 0 0 0 528 44.4 Z M 650.1 44.4 L 678.6 44.4 A 24.355 24.355 0 0 0 678.196 39.815 Q 677.7 37.231 676.596 35.207 A 12.422 12.422 0 0 0 674.8 32.7 A 12.488 12.488 0 0 0 667.839 28.924 A 18.395 18.395 0 0 0 664.3 28.6 Q 658.4 28.6 654.65 32.6 A 14.739 14.739 0 0 0 651.857 37.005 Q 651.032 38.961 650.552 41.361 A 32.287 32.287 0 0 0 650.1 44.4 Z M 858.7 44.4 L 887.2 44.4 A 24.355 24.355 0 0 0 886.796 39.815 Q 886.3 37.231 885.196 35.207 A 12.422 12.422 0 0 0 883.4 32.7 A 12.488 12.488 0 0 0 876.439 28.924 A 18.395 18.395 0 0 0 872.9 28.6 Q 867 28.6 863.25 32.6 A 14.739 14.739 0 0 0 860.457 37.005 Q 859.632 38.961 859.152 41.361 A 32.287 32.287 0 0 0 858.7 44.4 Z M 120.808 11.307 A 6.059 
6.059 0 0 0 125.2 13.1 A 8.264 8.264 0 0 0 126.856 12.942 A 5.661 5.661 0 0 0 129.8 11.4 A 5.588 5.588 0 0 0 131.271 8.768 A 7.987 7.987 0 0 0 131.5 6.8 A 7.26 7.26 0 0 0 131.5 6.719 A 6.06 6.06 0 0 0 129.65 2.35 A 7.395 7.395 0 0 0 129.592 2.293 A 6.059 6.059 0 0 0 125.2 0.5 A 8.264 8.264 0 0 0 123.544 0.658 A 5.661 5.661 0 0 0 120.6 2.2 A 5.588 5.588 0 0 0 119.129 4.832 A 7.987 7.987 0 0 0 118.9 6.8 A 7.26 7.26 0 0 0 118.9 6.881 A 6.06 6.06 0 0 0 120.75 11.25 A 7.395 7.395 0 0 0 120.808 11.307 Z M 222.608 11.307 A 6.059 6.059 0 0 0 227 13.1 A 8.264 8.264 0 0 0 228.656 12.942 A 5.661 5.661 0 0 0 231.6 11.4 A 5.588 5.588 0 0 0 233.071 8.768 A 7.987 7.987 0 0 0 233.3 6.8 A 7.26 7.26 0 0 0 233.3 6.719 A 6.06 6.06 0 0 0 231.45 2.35 A 7.395 7.395 0 0 0 231.392 2.293 A 6.059 6.059 0 0 0 227 0.5 A 8.264 8.264 0 0 0 225.344 0.658 A 5.661 5.661 0 0 0 222.4 2.2 A 5.588 5.588 0 0 0 220.929 4.832 A 7.987 7.987 0 0 0 220.7 6.8 A 7.26 7.26 0 0 0 220.7 6.881 A 6.06 6.06 0 0 0 222.55 11.25 A 7.395 7.395 0 0 0 222.608 11.307 Z" vector-effect="non-scaling-stroke"/></g></svg>`
); */

var mySvg = svgElementFromString(`
<svg width="300" height="300" xmlns="http://www.w3.org/2000/svg">
 <g>
  <title>Layer 1</title>
  <path d="m20.29579,35.29559c0,0 0,0.58823 0,2.35291c0,2.35291 0,8.82341 0,18.23506c0,12.35278 0,35.88189 0,52.35227c0,11.17632 0,16.47038 0,21.1762c0,1.17645 0,1.76468 -0.58823,1.76468l0,0l-3.52937,0" id="svg_4" stroke="#000" fill="none"/>
  <path d="m-2.05687,53.53065c0,0 2.40744,0.13909 7.05873,-1.76468c5.36164,-2.19452 8.51049,-3.52106 14.11747,-6.4705c3.75406,-1.97475 8.20865,-4.74872 12.94101,-7.64696c5.84996,-3.58269 10.98263,-7.48312 17.05861,-9.99987c3.43709,-1.42369 6.98125,-2.52267 9.41164,-3.52937c3.43709,-1.42369 6.94252,-2.60754 10.5881,-4.11759c3.43709,-1.42369 6.60542,-1.95997 8.82341,-2.94114c1.93958,-0.85801 3.03069,-1.31447 4.1176,-1.76468c0.76855,-0.31835 1.17645,-0.58823 1.76468,-1.17646l0,-0.58823l0.58823,-0.58823" id="svg_5" stroke="#000" fill="none"/>
  <path d="m56.17768,95.29482c0.58823,-0.58823 4.16041,-2.28344 7.05873,-4.11759c3.58434,-2.26828 4.60214,-3.22717 5.88228,-3.52937c0.57249,-0.13515 0.48641,-0.5016 0,-1.17645c-0.76908,-1.06704 -1.17646,-2.94114 -2.35291,-4.11759c-0.58823,-0.58823 -0.58823,-1.17646 -0.58823,-1.17646c0,0 0,-0.58823 0,-1.76468c0,-1.17646 -0.58823,-2.35291 -0.58823,-3.52937c0,-0.58823 -0.90511,-1.53318 -2.35291,-2.35291c-2.11052,-1.19495 -4.70582,-1.17645 -6.47051,-1.17645c-1.76468,0 -3.52937,0 -4.70582,0c-0.58823,0 -1.26281,0.50779 -2.35291,1.76468c-1.92704,2.22189 -2.77298,4.2421 -4.1176,5.88228c-1.0548,1.28665 -3.14477,3.35611 -4.11759,4.70583c-1.53815,2.13408 -1.76468,4.70582 -1.76468,6.4705c0,2.35291 -0.59136,4.76588 0,7.64696c0.90074,4.38832 3.37032,6.60513 5.88227,9.41164c2.77399,3.09929 6.3976,4.90767 9.41164,5.88228c2.30768,0.7462 5.25756,1.46956 8.82342,1.76468c2.93111,0.24258 6.40073,-0.17265 10.5881,-1.76468c3.47742,-1.32211 5.78303,-2.48264 8.82342,-4.70583c1.71202,-1.25185 3.52937,-2.94114 4.11759,-4.11759l0.58823,0l0.58823,-0.58823l0,-1.17646" id="svg_6" stroke="#000" fill="none"/>
  <path d="m109.7064,40.58964c0,0 -1.22366,-0.40544 -2.94114,0c-2.56026,0.6044 -3.71184,2.18761 -5.29404,4.1176c-1.34462,1.64017 -1.5221,4.12762 -1.76469,7.05873c-0.29512,3.56586 -0.58823,6.4705 -0.58823,9.99987c0,2.35291 -0.6185,3.70507 0,4.70582c0.6915,1.11887 3.52937,1.17645 7.64696,1.17645c5.88228,0 12.9595,0.21819 21.1762,-0.58823c4.71976,-0.46322 11.20277,-1.01945 14.7057,-0.58823c2.40715,0.29633 6.12326,2.07064 8.23518,4.11759c2.70459,2.62139 3.86438,4.78406 4.70583,7.05873c0.45634,1.23362 0.81332,1.80946 0.58823,2.35291c-0.95503,2.30567 -7.29213,5.82552 -15.88216,11.17633c-7.37184,4.592 -12.33157,7.10906 -16.47037,8.82341c-2.92657,1.21223 -4.70583,1.17646 -5.88228,1.17646c-1.76469,0 -3.52937,0 -4.11759,0l-0.58823,0l-0.58823,0l-1.17645,0" id="svg_7" stroke="#000" fill="none"/>
  <path d="m164.41158,27.64863c0,0.58823 0,1.17646 0,7.05873c0,7.05873 0,16.47038 0,27.05848c0,5.29405 -0.81088,9.50605 0,12.94101c0.3022,1.28014 0.70596,2.78128 2.35292,4.1176c2.45982,1.99588 4.66216,2.05735 7.64696,2.35291c2.34146,0.23185 4.23924,0.11021 5.29405,-1.17645c1.34462,-1.64017 2.28343,-4.74863 4.11758,-7.64696c1.13414,-1.79218 2.94115,-3.52937 3.52937,-4.1176c0.58823,-0.58823 0.58823,-1.17645 0.58823,-1.17645l0,-0.58823" id="svg_8" stroke="#000" fill="none"/>
  <path d="m161.47044,47.64838c0.58823,0 4.0513,-0.80981 7.64696,-1.76468c2.8989,-0.76984 5.90659,-1.08659 8.23518,-1.76468c1.78596,-0.52007 3.52937,-0.58823 4.1176,-0.58823c0.58823,0 1.17645,0 1.17645,0l0.58823,0" id="svg_9" stroke="#000" fill="none"/>
 </g>

</svg>`)

  console.log('heres my svg')
  console.log(mySvg);

  //var svgElement = document.getElementById('test-svg');
const paths = flattenSVG(mySvg);
console.log('flattenSVGPoints')
console.log(paths); 


var gerberFromPoints = generateSilkscreenFromPoints(paths)
console.log(gerberFromPoints);

function generateSilkscreenFromPoints(pointsArray){
    var silkscreenStr = ``

    silkscreenStr += silkscreenHeader;
    silkscreenStr += `X0Y0D03\n`


    pointsArray.forEach(points => {
        var pointCounter = 0
        points.points.forEach(point => {

            var startPointX = parseInt(parseFloat(point[0]).toFixed(5).replace('.', '')) 
            var startPointY = parseInt(parseFloat(point[1]).toFixed(5).replace('.', '')) 

            if (pointCounter === 0){
                silkscreenStr += `X${startPointX}Y-${startPointY}D03*\n`
            } else {
                silkscreenStr += `X${startPointX}Y-${startPointY}D01*\n`
            }
            //console.log(point);

            pointCounter ++;

        })
    })
  
    silkscreenStr += gerberEOF;

   // download('silkscreen_top.GTO', silkscreenStr);

    return silkscreenStr;
}




var svg = `
<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg">
 <g>
  <title>Layer 1</title>
  <line id="svg_37" y2="75.40317" x2="77.01607" y1="3.4678" x1="2.17748" stroke="#000" fill="none"/>
  <line id="svg_38" y2="3.95167" x2="76.85478" y1="74.43543" x1="2.98393" stroke="#000" fill="none"/>
 </g>

</svg>`

var gerberOut = svg_2_gerber(svg);
//download('silkscreen_top.GTO', gerberOut);
console.log(gerberOut);

 function svg_2_gerber(svg){

    var gerberStr = ``;

    let lines = getLines(svg);

    let mapping = createMapping(lines);

    gerberStr = generateSilkscreen(mapping);
 
    return gerberStr;
}

//convButton.onclick = svg_2_gerber(svg);

function convert(){
    console.log('ive been clicked')
}

convButton.onclick = testFunc();




function generateSilkscreen(mapping){
    var silkscreenStr = ``

    silkscreenStr += silkscreenHeader;
    silkscreenStr += `X0Y0D03\n`

    mapping.forEach(line => {
        let x1 = line.x1, x2 = line.x2, y1 = line.y1, y2 = line.y2;


         var startPointX = parseInt(parseFloat(x1).toFixed(5).replace('.', '')) 
        var endPointX = parseInt(parseFloat(x2).toFixed(5).replace('.', ''));
        
        var startPointY = parseInt(parseFloat(y1).toFixed(5).replace('.', '')) 
        var endPointY = parseInt(parseFloat(y2).toFixed(5).replace('.', '')); 


        silkscreenStr += `X-${startPointX}Y-${startPointY}D03*\n`
        silkscreenStr += `X-${endPointX}Y-${endPointY}D01*\n`
        
    })

    silkscreenStr += gerberEOF;

    return silkscreenStr;
}


//take string with svg and isolate all the line tags
function getLines(svgString){
    console.log(svgString);


    var svgSplit = svgString.split('\n');

    var lines = [];

    for (let i=0; i<svgSplit.length; i++){
        console.log(svgSplit[i])
        if (svgSplit[i].includes('<line')){
            lines.push(svgSplit[i]);
        }
    }

    console.log(lines);

    return lines;
     
}


function createMapping(lines){
    
    var mapping = [];
    
    lines.forEach(line => {
        var elements = line.split(' ');

        var id, x1, x2, y1, y2, stroke = null;

        elements.forEach(element => {

            if (element.substring(0,2) === 'id'){
                id = element.replace('id=', '').replace('\"', '').replace('\"', '');
            } 
            else if (element.substring(0, 2) === 'x1'){
                x1 = element.replace('x1=', '').replace('\"', '').replace('\"', '');
            } else if (element.substring(0, 2) === 'x2'){
                x2 = element.replace('x2=', '').replace('\"', '').replace('\"', '');;
            } else if (element.substring(0, 2) === 'y1'){
                y1 = element.replace('y1=', '').replace('\"', '').replace('\"', '');;
            } else if (element.substring(0, 2) === 'y2'){
                y2 = element.replace('y2=', '').replace('\"', '').replace('\"', '');;
            } else if (element.substring(0, 2) === 'st'){
                stroke = element.replace('stroke=', '').replace('\"', '').replace('\"', '');;
            }

        })


        mapping.push({
            id: id, 
            x1: x1, 
            x2: x2,
            y1: y1,
            y2: y2, 
            stroke: stroke,
        })
    })

    console.log(mapping);

    return mapping;
}


function download(filename, text)
{
 
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
}
